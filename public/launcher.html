import React, { useState } from "react";
import "./launcher.css";

const Launcher = () => {
  const [form, setForm] = useState({
    senderName: "",
    gmail: "",
    appPassword: "",
    subject: "",
    message: "",
    recipients: "",
  });

  const handleChange = (e) => {
    setForm({ ...form, [e.target.name]: e.target.value });
  };

  const sendMail = async () => {
    const recipientsList = form.recipients
      .split(/\r?\n|,/)
      .map(r => r.trim())
      .filter(Boolean);

    const res = await fetch("http://localhost:5000/send-bulk", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ...form, recipients: recipientsList })
    });

    alert(await res.text());
  };

  return (
    <div className="container">
      <h1>ðŸ“§ Fast Mail Launcher</h1>

      <div className="row">
        <input
          type="text"
          name="senderName"
          placeholder="Sender Name"
          onChange={handleChange}
        />
        <input
          type="email"
          name="gmail"
          placeholder="Your Gmail"
          onChange={handleChange}
        />
      </div>

      <div className="row">
        <input
          type="password"
          name="appPassword"
          placeholder="App Password"
          onChange={handleChange}
        />
        <input
          type="text"
          name="subject"
          placeholder="Email Subject"
          onChange={handleChange}
        />
      </div>

      <div className="row">
        <textarea
          name="message"
          placeholder="Message Body"
          onChange={handleChange}
        ></textarea>

        <textarea
          name="recipients"
          placeholder="Recipients (comma or newline)"
          onChange={handleChange}
        ></textarea>
      </div>

      <button onClick={sendMail}>Send All</button>
    </div>
  );
};

export default Launcher;
